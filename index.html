<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Myanmar Checkers</title>
  <style>
    body { display:flex; justify-content:center; align-items:center; height:100vh; background:#111; margin:0; }
    #board { display:grid; grid-template-columns:repeat(8,60px); grid-template-rows:repeat(8,60px); }
    .cell { width:60px; height:60px; display:flex; justify-content:center; align-items:center; }
    .dark { background:#333; }
    .light { background:#ddd; }
    .piece { width:45px; height:45px; border-radius:50%; display:flex; justify-content:center; align-items:center; font-size:22px; cursor:pointer; }
    .blue { background:#3af; color:white; }
    .red { background:#f44; color:white; }
    .king { border:3px solid gold; }
    .highlight { outline:3px solid yellow; }
  </style>
</head>
<body>
  <div id="board"></div>

<script>
const size=8;
let board=[], turn="blue", selected=null, moves=[];

function init(){
  board=[];
  for(let r=0;r<size;r++){
    board[r]=[];
    for(let c=0;c<size;c++){
      if((r+c)%2===1 && r<3) board[r][c]={color:"red",king:false};
      else if((r+c)%2===1 && r>4) board[r][c]={color:"blue",king:false};
      else board[r][c]=null;
    }
  }
  render();
}

function render(){
  const b=document.getElementById("board"); b.innerHTML="";
  for(let r=0;r<size;r++){
    for(let c=0;c<size;c++){
      const cell=document.createElement("div");
      cell.className="cell "+((r+c)%2?"dark":"light");
      cell.onclick=()=>handleClick(r,c);
      if(board[r][c]){
        const p=board[r][c];
        const piece=document.createElement("div");
        piece.className="piece "+p.color+(p.king?" king":"");
        piece.textContent=p.king?"K":"";
        if(selected && selected.r===r && selected.c===c) piece.classList.add("highlight");
        cell.appendChild(piece);
      }
      if(moves.some(m=>m.r===r && m.c===c)){
        cell.style.outline="3px solid lime";
      }
      b.appendChild(cell);
    }
  }
}

function handleClick(r,c){
  if(turn!=="blue") return;
  const p=board[r][c];
  if(p && p.color===turn){
    selected={r,c};
    moves=legalMoves(r,c);
    render();
  } else if(selected){
    const move=moves.find(m=>m.r===r && m.c===c);
    if(move) makeMove(selected.r,selected.c,move);
  }
}

function inside(r,c){ return r>=0 && r<size && c>=0 && c<size; }

function legalMoves(r,c){
  const p=board[r][c]; if(!p) return [];
  let moves=[];
  if(p.king){
    // Kings move in all 4 diagonal directions
    for(const [dr,dc] of [[1,1],[1,-1],[-1,1],[-1,-1]]){
      let nr=r+dr, nc=c+dc;
      while(inside(nr,nc) && !board[nr][nc]){
        moves.push({r:nr,c:nc,captures:[],isCapture:false});
        nr+=dr; nc+=dc;
      }
      if(inside(nr,nc) && board[nr][nc]?.color!==p.color){
        let lr=nr+dr, lc=nc+dc;
        if(inside(lr,lc) && !board[lr][lc]){
          moves.push({r:lr,c:lc,captures:[{r:nr,c:nc}],isCapture:true});
        }
      }
    }
  } else {
    // Normal pawns - Myanmar rules (forward only)
    const forwardDirs = p.color==="blue" ? [[-1,-1],[-1,1]] : [[1,-1],[1,1]];
    for(const [dr,dc] of forwardDirs){
      const nr=r+dr, nc=c+dc;
      if(inside(nr,nc) && !board[nr][nc]){
        moves.push({r:nr,c:nc,captures:[],isCapture:false});
      }
    }
    for(const [dr,dc] of forwardDirs){
      const mr=r+dr, mc=c+dc, lr=r+2*dr, lc=c+2*dc;
      if(
        inside(lr,lc) &&
        board[mr]?.[mc] &&
        board[mr][mc].color!==p.color &&
        !board[lr][lc]
      ){
        moves.push({r:lr,c:lc,captures:[{r:mr,c:mc}],isCapture:true});
      }
    }
  }
  return moves;
}

function makeMove(r,c,move){
  const p=board[r][c]; 
  board[r][c]=null; 
  board[move.r][move.c]=p;

  // Remove captured pieces
  if(move.captures && move.captures.length>0){
    move.captures.forEach(cap=>board[cap.r][cap.c]=null);
  }

  // Promote to king
  if(!p.king && (move.r===0 || move.r===size-1)) p.king=true;

  // Only allow continuation if capture happened AND more captures exist
  if(move.captures && move.captures.length>0){
    const cont = legalMoves(move.r, move.c).filter(m => m.captures && m.captures.length>0);
    if(cont.length > 0){
      selected={r:move.r,c:move.c};
      moves=cont;
      render();
      return;
    }
  }

  // Otherwise end turn
  selected=null;
  moves=[];
  turn = (turn==="blue") ? "red" : "blue";
  render();

  if(turn==="red") setTimeout(aiMove,600);
}

function aiMove(){
  let aiMoves=[];
  for(let r=0;r<size;r++){
    for(let c=0;c<size;c++){
      const p=board[r][c];
      if(p && p.color==="red"){
        for(const m of legalMoves(r,c)) aiMoves.push({r,c,move:m});
      }
    }
  }
  if(aiMoves.length===0) return;
  const choice=aiMoves[Math.floor(Math.random()*aiMoves.length)];
  makeMove(choice.r,choice.c,choice.move);
}

init();
</script>
</body>
</html>
