<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spanish Checkers (Damas)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      background:#1a1a1a;
      color:white;
      margin:0;
      padding:10px;
      font-family:Arial, sans-serif;
    }
    #controls {
      display:flex;
      justify-content:center;
      align-items:center;
      gap:10px;
      margin:10px;
    }
    select, button {
      padding:10px 16px;
      font-size:16px;
      border-radius:12px;
      border:none;
      box-shadow:0 3px 6px rgba(0,0,0,0.4);
    }
    button {
      background:#3af;
      color:white;
      cursor:pointer;
    }
    button:active {
      transform:scale(0.95);
      background:#28c;
    }
    select {
      background:#444;
      color:white;
    }
    #board {
      display:grid;
      grid-template-columns:repeat(8,1fr);
      grid-template-rows:repeat(8,1fr);
      width:95vmin;
      height:95vmin;
      border:8px solid #654321;
      border-radius:12px;
      box-shadow:0 0 15px rgba(0,0,0,0.7);
      background:#442;
    }
    .cell {
      display:flex;
      justify-content:center;
      align-items:center;
    }
    .dark { background:#5a3d2e; }
    .light { background:#e0c097; }
    .piece {
      width:80%;
      height:80%;
      border-radius:50%;
      display:flex;
      justify-content:center;
      align-items:center;
      font-size:5vmin;
      font-weight:bold;
      cursor:pointer;
      box-shadow:0 3px 6px rgba(0,0,0,0.5);
      transition:0.2s;
    }
    .piece:active { transform:scale(0.9); }
    .blue { background:linear-gradient(#4ad, #138); color:white; }
    .red { background:linear-gradient(#f66, #900); color:white; }
    .king { border:3px solid gold; box-shadow:0 0 12px gold; }
    .highlight { outline:4px solid yellow; }
  </style>
</head>
<body>
  <div id="controls">
    <select id="level">
      <option value="easy">Easy</option>
      <option value="medium">Medium</option>
      <option value="hard">Hard</option>
    </select>
    <button onclick="init()">Restart</button>
  </div>
  <div id="board"></div>

  <!-- Sound effects -->
  <audio id="moveSound" src="move.mp3"></audio>
  <audio id="captureSound" src="capture.mp3"></audio>
  <audio id="winSound" src="win.mp3"></audio>

<script>
const size=8;
let board=[], turn="blue", selected=null, moves=[], difficulty="easy";

// sounds
const moveSound=document.getElementById("moveSound");
const captureSound=document.getElementById("captureSound");
const winSound=document.getElementById("winSound");

document.getElementById("level").addEventListener("change", e=>{
  difficulty = e.target.value;
});

// initialize board
function init(){
  board=[];
  for(let r=0;r<size;r++){
    board[r]=[];
    for(let c=0;c<size;c++){
      if((r+c)%2===1 && r<3) board[r][c]={color:"red",king:false};
      else if((r+c)%2===1 && r>4) board[r][c]={color:"blue",king:false};
      else board[r][c]=null;
    }
  }
  turn="blue"; selected=null; moves=[];
  render();
}

// render board
function render(){
  const b=document.getElementById("board"); b.innerHTML="";
  for(let r=0;r<size;r++){
    for(let c=0;c<size;c++){
      const cell=document.createElement("div");
      cell.className="cell "+((r+c)%2?"dark":"light");
      cell.onclick=()=>handleClick(r,c);
      if(board[r][c]){
        const p=board[r][c];
        const piece=document.createElement("div");
        piece.className="piece "+p.color+(p.king?" king":"");
        piece.textContent=p.king?"K":"";
        if(selected && selected.r===r && selected.c===c) piece.classList.add("highlight");
        cell.appendChild(piece);
      }
      if(moves.some(m=>m.r===r && m.c===c)){
        cell.style.outline="3px solid lime";
      }
      b.appendChild(cell);
    }
  }
}

function inside(r,c){ return r>=0 && r<size && c>=0 && c<size; }

// compute legal moves for a piece (Spanish rules)
function legalMoves(r,c){
  const p=board[r][c]; if(!p) return [];
  let moves=[];
  if(p.king){
    for(const [dr,dc] of [[1,1],[1,-1],[-1,1],[-1,-1]]){
      let nr=r+dr, nc=c+dc;
      while(inside(nr,nc) && !board[nr][nc]){
        moves.push({r:nr,c:nc,captures:[],isCapture:false});
        nr+=dr; nc+=dc;
      }
      if(inside(nr,nc) && board[nr][nc]?.color!==p.color){
        let lr=nr+dr, lc=nc+dc;
        if(inside(lr,lc) && !board[lr][lc]){
          moves.push({r:lr,c:lc,captures:[{r:nr,c:nc}],isCapture:true});
        }
      }
    }
  } else {
    const forwardDirs = p.color==="blue" ? [[-1,-1],[-1,1]] : [[1,-1],[1,1]];
    for(const [dr,dc] of forwardDirs){
      const nr=r+dr, nc=c+dc;
      if(inside(nr,nc) && !board[nr][nc]){
        moves.push({r:nr,c:nc,captures:[],isCapture:false});
      }
    }
    for(const [dr,dc] of forwardDirs){
      const mr=r+dr, mc=c+dc, lr=r+2*dr, lc=c+2*dc;
      if(inside(lr,lc) && board[mr]?.[mc] && board[mr][mc].color!==p.color && !board[lr][lc]){
        moves.push({r:lr,c:lc,captures:[{r:mr,c:mc}],isCapture:true});
      }
    }
  }
  return moves;
}

// get all moves for player, enforcing Spanish capture rules
function getAllMoves(color){
  let all=[];
  for(let r=0;r<size;r++){
    for(let c=0;c<size;c++){
      const p=board[r][c];
      if(p && p.color===color){
        for(const m of legalMoves(r,c)) all.push({r,c,move:m});
      }
    }
  }
  const captures=all.filter(m=>m.move.isCapture);
  if(captures.length>0){
    const maxLen=Math.max(...captures.map(m=>m.move.captures.length));
    return captures.filter(m=>m.move.captures.length===maxLen);
  }
  return all;
}

function handleClick(r,c){
  if(turn!=="blue") return;
  const p=board[r][c];
  let allMoves=getAllMoves("blue");
  const hasCaptures = allMoves.some(m=>m.move.isCapture);

  if(p && p.color===turn){
    selected={r,c};
    moves=legalMoves(r,c);
    if(hasCaptures) moves = moves.filter(m=>m.isCapture);
    render();
  } else if(selected){
    const move=moves.find(m=>m.r===r && m.c===c);
    if(move) makeMove(selected.r,selected.c,move);
  }
}

function makeMove(r,c,move){
  const p=board[r][c]; board[r][c]=null; board[move.r][move.c]=p;
  if(move.isCapture){
    move.captures.forEach(cap=>board[cap.r][cap.c]=null);
    captureSound.play();
  } else moveSound.play();

  if(!p.king && (move.r===0 || move.r===size-1)) p.king=true;

  if(move.isCapture){
    const cont = legalMoves(move.r, move.c).filter(m=>m.isCapture);
    if(cont.length > 0){
      selected={r:move.r,c:move.c};
      moves=cont;
      render();
      return;
    }
  }
  selected=null; moves=[];
  turn=(turn==="blue")?"red":"blue";
  render();
  if(turn==="red") setTimeout(aiMove,600);
}

// AI logic
function aiMove(){
  let aiMoves=getAllMoves("red");
  if(aiMoves.length===0){ winSound.play(); return; }
  let choice;
  if(difficulty==="easy"){
    choice=aiMoves[Math.floor(Math.random()*aiMoves.length)];
  } else if(difficulty==="medium"){
    const captures=aiMoves.filter(m=>m.move.isCapture);
    if(captures.length>0) choice=captures[Math.floor(Math.random()*captures.length)];
    else choice=aiMoves[Math.floor(Math.random()*aiMoves.length)];
  } else {
    // Hard mode: minimax placeholder (random best capture)
    const captures=aiMoves.filter(m=>m.move.isCapture);
    if(captures.length>0) choice=captures[0]; else choice=aiMoves[0];
  }
  makeMove(choice.r,choice.c,choice.move);
}

init();
</script>
</body>
</html>
